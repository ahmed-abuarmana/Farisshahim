{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ takiya.name }} - Ø§Ù„ÙØ§Ø±Ø³ Ø§Ù„Ø´Ù‡Ù… 3</title>
    <style>
      /* Reset */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      /* Body & Background */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        direction: rtl;
        background: linear-gradient(135deg, #f8fafb 0%, #e8f4f8 100%);
        color: #2c3e50;
        min-height: 100vh;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
      }
      /* Subtle animated radial pattern background */
      body::before {
        content: "";
        position: fixed;
        top: -50px;
        left: -50px;
        width: 200px;
        height: 200px;
        background: radial-gradient(
          circle,
          rgba(41, 128, 185, 0.03) 1px,
          transparent 1px
        );
        background-size: 50px 50px;
        z-index: 0;
        pointer-events: none;
        animation: backgroundMove 20s linear infinite;
      }
      @keyframes backgroundMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(50px, 50px);
        }
      }

      /* Container */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 40px 35px;
        border-radius: 16px;
        margin-bottom: 35px;
        box-shadow: 0 8px 24px rgba(52, 152, 219, 0.25);
        text-align: center;
        position: relative;
        overflow: hidden;
        animation: fadeInDown 0.8s ease-out;
      }
      .header::before {
        content: "";
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 1px,
          transparent 1px
        );
        background-size: 30px 30px;
        animation: headerBgMove 15s linear infinite;
        z-index: 0;
      }
      @keyframes headerBgMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(30px, 30px);
        }
      }
      @keyframes fadeInDown {
        0% {
          opacity: 0;
          transform: translateY(-30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .header h1 {
        font-size: 2.4rem;
        margin-bottom: 12px;
        font-weight: 700;
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .header .subtitle {
        opacity: 0.95;
        font-size: 1.2rem;
        position: relative;
        z-index: 1;
      }

      /* Navigation Buttons */
      .nav-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 35px;
        flex-wrap: wrap;
        animation: fadeInUp 0.8s ease-out 0.2s both;
      }
      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .nav-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        font-size: 15px;
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.25);
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
      }
      .nav-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
        z-index: 1;
      }
      .nav-btn:hover::before {
        left: 100%;
      }
      .nav-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.35);
      }
      .nav-btn.danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
      }
      .nav-btn.danger:hover {
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.35);
      }
      .nav-btn.danger::before {
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.15),
          transparent
        );
      }
      /* Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ */
      .nav-btn.edit-btn-takiya {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }


      /* Card style */
      .card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 35px;
        box-shadow: 0 6px 24px rgba(52, 152, 219, 0.12);
        animation: fadeInUp 0.8s ease-out both;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(52, 152, 219, 0.15);
      }
      .card h2 {
        color: #2980b9;
        margin-bottom: 25px;
        padding-bottom: 12px;
        border-bottom: 3px solid #3498db;
        font-weight: 600;
        font-size: 1.6rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Info Grid */
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }
      .info-item {
        display: flex;
        flex-direction: column;
        animation: fadeIn 0.6s ease-out both;
      }
      .info-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .info-item:nth-child(2) {
        animation-delay: 0.15s;
      }
      .info-item:nth-child(3) {
        animation-delay: 0.2s;
      }
      .info-item:nth-child(4) {
        animation-delay: 0.25s;
      }
      .info-label {
        font-weight: 600;
        color: #7f8c8d;
        margin-bottom: 10px;
        font-size: 0.95rem;
      }
      .info-value {
        padding: 14px 18px;
        background: linear-gradient(135deg, #f8fafb 0%, #ecf0f1 100%);
        border-radius: 10px;
        border-right: 4px solid #3498db;
        color: #2c3e50;
        font-weight: 500;
        min-height: 50px;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
      }
      /* Ù†Ù…Ø· ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ - ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙƒØ¯Ù„ÙŠÙ„ */
      .info-value.editable {
        border-right-color: #2980b9; 
        background: #fff; 
        box-shadow: 0 0 0 1px #2980b920; 
      }
      .info-value:hover {
        background: linear-gradient(135deg, #ecf0f1 0%, #e0e6e8 100%);
        transform: translateX(-3px);
      }
      .info-value.editable:hover {
        background: #fff;
        transform: none; 
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }
      .stat-item {
        text-align: center;
        padding: 25px 20px;
        background: linear-gradient(135deg, #f8fafb 0%, #ecf0f1 100%);
        border-radius: 12px;
        border-top: 4px solid #3498db;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        animation: scaleIn 0.6s ease-out both;
        cursor: default;
      }
      /* Ù†Ù…Ø· ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ - ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙƒØ¯Ù„ÙŠÙ„ */
      .stat-item.editable {
        border-top-color: #2980b9; 
        background: #fff; 
        box-shadow: 0 0 0 1px #2980b920; 
      }
      .stat-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .stat-item:nth-child(2) {
        animation-delay: 0.15s;
      }
      .stat-item:nth-child(3) {
        animation-delay: 0.2s;
      }
      .stat-item:nth-child(4) {
        animation-delay: 0.25s;
      }
      .stat-item:nth-child(5) {
        animation-delay: 0.3s;
      }
      .stat-item:nth-child(6) {
        animation-delay: 0.35s;
      }
      .stat-item:nth-child(7) {
        animation-delay: 0.4s;
      }
      .stat-item:nth-child(8) {
        animation-delay: 0.45s;
      }
      .stat-item:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 8px 20px rgba(52, 152, 219, 0.15);
      }
      .stat-item.editable:hover {
        transform: none;
        box-shadow: none;
      }
      .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #3498db;
        margin-bottom: 10px;
      }
      .stat-item.editable .stat-value {
        color: #2980b9; 
      }
      .stat-label {
        color: #7f8c8d;
        font-weight: 500;
        font-size: 0.95rem;
      }
      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Table Container */
      .table-container {
        overflow-x: auto;
        background: white;
        border-radius: 14px;
        box-shadow: 0 4px 16px rgba(52, 152, 219, 0.1);
      }

      /* Data Table */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1000px;
      }
      .data-table th {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 18px 14px;
        text-align: center;
        font-weight: 600;
        font-size: 0.95rem;
        white-space: nowrap;
        position: relative;
      }
      .data-table th::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: rgba(255, 255, 255, 0.3);
      }
      .data-table td {
        padding: 14px 12px;
        text-align: center;
        border-bottom: 1px solid #ecf0f1;
        color: #2c3e50;
        transition: background-color 0.2s ease;
      }
      .data-table tbody tr:nth-child(even) {
        background-color: #f8fafb;
      }
      .data-table tbody tr:hover {
        background-color: #e8f4f8;
        transform: scale(1.005);
      }

      /* Add New Row */
      .add-row {
        background: linear-gradient(
          135deg,
          #e8f4f8 0%,
          #d1ecf1 100%
        ) !important;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .add-row:hover {
        background: linear-gradient(
          135deg,
          #d1ecf1 0%,
          #bee5eb 100%
        ) !important;
      }
      .add-row td {
        color: #3498db !important;
        font-weight: 600;
        padding: 18px !important;
        font-size: 1.05rem;
      }

      /* Form Input Styles */
      .form-input {
        width: 90%;
        padding: 10px 12px;
        border: 2px solid #bdc3c7;
        border-radius: 8px;
        outline: none;
        transition: all 0.3s ease;
        font-size: 14px;
        background: white;
      }
      .form-input:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
        transform: scale(1.02);
      }
      /* Input style in info-value/stat-item */
      .info-value .form-input, .stat-item .form-input {
        width: 100%;
        margin: -5px 0; 
        border: none;
        box-shadow: none;
        text-align: inherit;
        font-weight: 500;
      }
      .info-value .form-input:focus, .stat-item .form-input:focus {
        border: none;
        box-shadow: none;
        transform: none;
      }

      /* Action Buttons */
      .action-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        margin: 12px 6px;
        font-size: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .action-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
        z-index: 1;
      }
      .action-btn:hover::before {
        left: 100%;
      }
      /* Ø²Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
      .action-btn.save, .action-btn.update-takiya-save {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }
      .action-btn.save:hover, .action-btn.update-takiya-save:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
      }
      .action-btn.cancel {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
      }
      .action-btn.cancel:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(149, 165, 166, 0.3);
      }

      /* Back Link */
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 14px 28px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        transition: all 0.3s ease;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.25);
        margin-top: 25px;
      }
      .back-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.35);
      }

      /* No Data State */
      .no-data {
        text-align: center;
        padding: 50px 20px;
        color: #7f8c8d;
        font-style: italic;
        background: #f8fafb;
        border-radius: 8px;
        font-size: 1.1rem;
      }
      
      /* New Container for Edit/Save buttons */
      .edit-actions-container {
          text-align: center;
          margin-bottom: 35px;
          animation: fadeInUp 0.8s ease-out 0.2s both;
      }

      /* Responsive */
      @media (max-width: 768px) {
        body {
          padding: 15px;
        }
        .container {
          padding: 0;
        }
        .header h1 {
          font-size: 1.8rem;
        }
        .header .subtitle {
          font-size: 1rem;
        }
        .nav-buttons {
          gap: 10px;
        }
        .nav-btn {
          padding: 10px 18px;
          font-size: 14px;
        }
        .info-grid,
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .data-table {
          font-size: 0.85rem;
        }
        .data-table th,
        .data-table td {
          padding: 10px 8px;
        }
        .stat-value {
          font-size: 1.4rem;
        }
        .card {
          padding: 20px;
        }
        .card h2 {
          font-size: 1.4rem;
        }
      }
      @media (max-width: 480px) {
        .nav-buttons {
          flex-direction: column;
          align-items: center;
        }
        .nav-btn {
          width: 100%;
          max-width: 300px;
        }
        .back-link {
          width: max-content;
          padding: 12px 24px;
        }
      }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1 id="takiya-name-display">{{ takiya.name }}</h1>
        <div class="subtitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙŠØ© - Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙØ§Ø±Ø³ Ø§Ù„Ø´Ù‡Ù… 3</div>
      </div>
      <div class="nav-buttons">
        <a href="{% url 'takiyat_list' %}" class="nav-btn">
            <i class="fas fa-list"></i>
            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙƒÙŠØ§Øª
        </a>
        <button class="nav-btn edit-btn-takiya" id="edit-toggle-btn" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
            <i class="fas fa-edit"></i>
            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        <a href="{% url 'index' %}" class="nav-btn">
            <i class="fas fa-home"></i>
            Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
        <form
          action="{% url 'delete_takiya' takiya.id %}"
          method="POST"
          style="display: inline"
          onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØªÙƒÙŠØ©ØŸ âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø§.')"
        >
          {% csrf_token %}
            <button type="submit" class="nav-btn danger">
                <i class="fas fa-trash-alt" style="margin-left: 5px;"></i> Ø­Ø°Ù Ø§Ù„ØªÙƒÙŠØ©
            </button>

        </form>
      </div>

      <div class="card" id="basic-info-card">
        <h2>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Ø§Ø³Ù… Ø§Ù„ØªÙƒÙŠØ©</span>
                <div class="info-value" data-field="name" data-type="text">{{ takiya.name|default:"-" }}</div>
            </div>
            <div class="info-item">
                <span class="info-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</span>
                <div class="info-value" data-field="owner_name" data-type="text">{{ takiya.owner_name|default:"-" }}</div>
            </div>
          <div class="info-item">
            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span>
            <div class="info-value" data-field="mobile_number" data-type="tel">{{ takiya.mobile_number|default:"-" }}</div>
          </div>
          <div class="info-item">
            <span class="info-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</span>
            <div class="info-value" data-field="governorate" data-type="select" data-choices='{
                "Ø±ÙØ­": "Ø±ÙØ­", 
                "Ø®Ø§Ù† ÙŠÙˆÙ†Ø³": "Ø®Ø§Ù† ÙŠÙˆÙ†Ø³", 
                "Ø§Ù„ÙˆØ³Ø·Ù‰": "Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„ÙˆØ³Ø·Ù‰"
            }' data-current="{{ takiya.governorate|default:'' }}">
              {{ takiya.get_governorate_display|default:"-" }}
            </div>
          </div>
          <div class="info-item">
            <span class="info-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span>
            <div class="info-value" data-field="address" data-type="text">{{ takiya.address|default:"-" }}</div>
          </div>
          <div class="info-item">
            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</span>
            <div class="info-value" data-field="owner_id" data-type="text">{{ takiya.owner_id|default:"-" }}</div>
          </div>
          <div class="info-item">
            <span class="info-label">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</span>
            <div class="info-value" data-field="coordinates" data-type="text">{{ takiya.coordinates|default:"-" }}</div>
          </div>
          <div class="info-item">
            <span class="info-label">Ø§Ù„Ø­Ø§Ù„Ø©</span>
            <div class="info-value" data-field="status" data-type="select" data-choices='{
                "ÙØ¹Ø§Ù„": "ÙØ¹Ø§Ù„", 
                "Ù…ØªÙˆÙ‚Ù": "Ù…ØªÙˆÙ‚Ù"
            }' data-current="{{ takiya.status|default:'' }}">
              {{ takiya.get_status_display|default:"-" }}
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="equipment-card">
        <h2>Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ø®</h2>
        <div class="stats-grid">
          <div class="stat-item" data-field="total_pots" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.total_pots|default:"0" }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø¯ÙˆØ±</div>
          </div>
          <div class="stat-item" data-field="pots_80" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.pots_80|default:"0" }}</div>
            <div class="stat-label">Ù‚Ø¯ÙˆØ± 80 Ù„ØªØ±</div>
          </div>
          <div class="stat-item" data-field="pots_100" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.pots_100|default:"0" }}</div>
            <div class="stat-label">Ù‚Ø¯ÙˆØ± 100 Ù„ØªØ±</div>
          </div>
          <div class="stat-item" data-field="pots_120" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.pots_120|default:"0" }}</div>
            <div class="stat-label">Ù‚Ø¯ÙˆØ± 120 Ù„ØªØ±</div>
          </div>
          <div class="stat-item" data-field="pots_150" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.pots_150|default:"0" }}</div>
            <div class="stat-label">Ù‚Ø¯ÙˆØ± 150 Ù„ØªØ±</div>
          </div>
          <div class="stat-item" data-field="pots_200" data-type="number" data-suffix="">
            <div class="stat-value">{{ takiya.pots_200|default:"0" }}</div>
            <div class="stat-label">Ù‚Ø¯ÙˆØ± 200 Ù„ØªØ±</div>
          </div>
          <div class="stat-item" data-field="daily_capacity" data-type="number" data-suffix=" (Ù‚Ø¯Ø±)">
            <div class="stat-value">
              {{ takiya.daily_capacity|default:"0" }}
            </div>
            <div class="stat-label">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ù‚Ø¯Ø±)</div>
          </div>
          {% comment %} <div class="stat-item">
            <div class="stat-value">{{ total_pots_all }}</div>
            <div class="stat-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù‚Ø¯ÙˆØ±</div>
          </div> {% endcomment %}
        </div>
      </div>

      <div class="edit-actions-container" id="edit-actions-container" style="display: none;">
          <button class="action-btn update-takiya-save" onclick="saveTakiyaData()">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
          </button>
          <button class="action-btn cancel" onclick="toggleEditMode()">
              <i class="fas fa-times"></i>
              Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
          </button>
      </div>

      <div class="card">
        <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ total_deliveries }}</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ total_salt }} ÙƒØºÙ…</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„Ø­</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ total_rice }} ÙƒØºÙ…</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø²</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ total_oil }} Ù„ØªØ±</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØª</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ total_macaroni }} ÙƒØºÙ…</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹ÙƒØ±ÙˆÙ†Ø©</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ total_lentils }} ÙƒØºÙ…</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø³</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">
              {% if latest_taslim %} {{ latest_taslim.taslima_date }} {% else %}
              - {% endif %}
            </div>
            <div class="stat-label">Ø¢Ø®Ø± ØªØ§Ø±ÙŠØ® ØªØ³Ù„ÙŠÙ…</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h2>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª</h2>
        <div class="table-container">
          <table class="data-table" id="delivery-table">
            <thead>
              <tr>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                <th>Ø§Ù„Ù…Ù„Ø­ (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ù…Ø¹ÙƒØ±ÙˆÙ†Ø© (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ø£Ø±Ø² (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ø²ÙŠØª (Ù„ØªØ±)</th>
                <th>Ø§Ù„Ø¨Ø§Ø²ÙŠÙ„Ø§ (Ø¹Ù„Ø¨)</th>
                <th>Ø§Ù„Ø¹Ø¯Ø³ Ø§Ù„Ù…Ø¬Ø±ÙˆØ´ (ÙƒØºÙ…)</th>
                <th>Ù„ÙˆØ¨ÙŠØ§ Ø­Ø¨ (ÙƒØºÙ…)</th>
                <th>Ø§Ù„ØµÙ„ØµØ© (Ø¹Ù„Ø¨Ø©)</th>
                <th>Ù„Ø§Ù†Ø´ÙˆÙ† (Ø¹Ù„Ø¨Ø©)</th>
                <th>Ø¨Ù‡Ø§Ø± Ù…Ø§Ø¬ÙŠ (ÙƒØºÙ…)</th>
                <th>Ø´ÙˆØ±Ø¨Ø© Ø®Ø¶Ø§Ø± (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ù€7 Ø¨Ù‡Ø§Ø±Ø§Øª (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ø³Ù…Ù†Ø© (Ø¹Ù„Ø¨Ø©)</th>
                <th>Ø§Ù„Ø¨Ø±ØºÙ„ (ÙƒØºÙ…)</th>
                <th>Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</th>
              </tr>
            </thead>
            <tbody id="delivery-body">
              {% for taslim in all_tasleemat %}
              <tr>
                <td>{{ taslim.taslima_date }}</td>
                <td>{{ taslim.salt|default:"-" }}</td>
                <td>{{ taslim.macaroni|default:"-" }}</td>
                <td>{{ taslim.rice|default:"-" }}</td>
                <td>{{ taslim.oil|default:"-" }}</td>
                <td>{{ taslim.peas|default:"-" }}</td>
                <td>{{ taslim.lentils|default:"-" }}</td>
                <td>{{ taslim.beans|default:"-" }}</td>
                <td>{{ taslim.sauce|default:"-" }}</td>
                <td>{{ taslim.luncheon|default:"-" }}</td>
                <td>{{ taslim.maggi_spice|default:"-" }}</td>
                <td>{{ taslim.vegetable_soup|default:"-" }}</td>
                <td>{{ taslim.seven_spices|default:"-" }}</td>
                <td>{{ taslim.ghee|default:"-" }}</td>
                <td>{{ taslim.bulgur|default:"-" }}</td>
                <td>{{ taslim.additions|default:"-" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="16" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ù„ÙŠÙ…Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr class="add-row" id="add-row" onclick="showNewRow()">
                <td colspan="16">â• Ø¥Ø¶Ø§ÙØ© ØªØ³Ù„ÙŠÙ… Ø¬Ø¯ÙŠØ¯</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <div style="text-align: center">
        <a href="{% url 'takiyat_list' %}" class="back-link"
          >â† Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙƒÙŠØ§Øª</a
        >
      </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ± Ø¹Ø§Ù„Ù…ÙŠ Ù„ØªØªØ¨Ø¹ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        let isEditing = false;
        const takiyaId = {{ takiya.id }};
        const updateUrl = "{% url 'update_takiya' pk=takiya.id %}";
        const csrfToken = "{{ csrf_token }}";

        const basicInfoItems = document.querySelectorAll('#basic-info-card .info-value');
        const equipmentItems = document.querySelectorAll('#equipment-card .stat-item');
        const editToggleBtn = document.getElementById('edit-toggle-btn');
        const editActionsContainer = document.getElementById('edit-actions-container'); // Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø±


        // Ù‚Ø§Ø¦Ù…Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        const initialBasicInfoData = {};
        basicInfoItems.forEach(item => {
            const field = item.dataset.field;
            initialBasicInfoData[field] = item.textContent.trim();
        });

        // Ù‚Ø§Ø¦Ù…Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        const initialEquipmentData = {};
        equipmentItems.forEach(item => {
            const field = item.dataset.field;
            // ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙƒÙ†Øµ
            const valueElement = item.querySelector('.stat-value');
            if(valueElement) {
                initialEquipmentData[field] = valueElement.textContent.trim().replace(item.dataset.suffix, '').trim();
            }
        });


        /**
         * Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙˆÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙŠØ©.
         */
        function toggleEditMode() {
            isEditing = !isEditing;

            // 1. ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù„ÙˆÙŠ
            editToggleBtn.innerHTML = isEditing ? '<i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„' : '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            // ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ù†Ø¬Ø¹Ù„ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„/Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø±Ù…Ø§Ø¯ÙŠÙ‹Ø§.
            editToggleBtn.style.background = isEditing ? 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)' : 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';

            // 2. Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠØ©
            editActionsContainer.style.display = isEditing ? 'block' : 'none';

            // 3. ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø­Ù‚ÙˆÙ„
            basicInfoItems.forEach(item => {
                if (isEditing) {
                    convertToInput(item);
                    item.classList.add('editable');
                } else {
                    convertToDisplay(item);
                    item.classList.remove('editable');
                }
            });

            equipmentItems.forEach(item => {
                if (item.dataset.field) {
                    const valueElement = item.querySelector('.stat-value');
                    if (isEditing) {
                        convertToInputStat(valueElement, item);
                        item.classList.add('editable');
                    } else {
                        convertToDisplayStat(valueElement, item);
                        item.classList.remove('editable');
                    }
                }
            });
        }

        /**
         * ØªØ­ÙˆÙŠÙ„ Ø¹Ù†ØµØ± info-value Ø¥Ù„Ù‰ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„/Ø§Ø®ØªÙŠØ§Ø±.
         * @param {HTMLElement} item - Ø¹Ù†ØµØ± info-value
         */
        function convertToInput(item) {
            const field = item.dataset.field;
            const type = item.dataset.type;
            const currentValue = item.textContent.trim();
            let inputElement;

            // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù„ØºØ§Ø¡
            item.dataset.initialValue = currentValue;

            if (type === 'select') {
                inputElement = document.createElement('select');
                const choices = JSON.parse(item.dataset.choices);
                
                // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± ÙØ§Ø±Øº
                let currentModelValue = item.dataset.current;
                
                // ØªØ¹Ø¨Ø¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                for (const modelValue in choices) {
                    const option = document.createElement('option');
                    option.value = modelValue;
                    option.textContent = choices[modelValue];
                    if (modelValue === currentModelValue) {
                         option.selected = true;
                    }
                    inputElement.appendChild(option);
                }

            } else { // type === 'text' Ø£Ùˆ 'tel'
                inputElement = document.createElement('input');
                inputElement.type = type === 'tel' ? 'text' : type;
                inputElement.value = currentValue === '-' ? '' : currentValue;
            }
            
            inputElement.name = field;
            inputElement.className = "form-input";
            inputElement.style.width = "100%"; 

            item.innerHTML = '';
            item.appendChild(inputElement);
        }

        /**
         * Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ù†ØµØ± info-value Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶.
         * @param {HTMLElement} item - Ø¹Ù†ØµØ± info-value
         */
        function convertToDisplay(item) {
            const inputElement = item.querySelector('.form-input');
            const type = item.dataset.type;
            const initialValue = item.dataset.initialValue;

            if (!inputElement) return;

            if (type === 'select') {
                const selectedText = inputElement.options[inputElement.selectedIndex].text;
                const selectedValue = inputElement.value;
                item.textContent = selectedText || initialValue;
                item.dataset.current = selectedValue;

            } else {
                item.textContent = inputElement.value || initialValue;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ØªÙƒÙŠØ© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§
            if (item.dataset.field === 'name') {
                 document.getElementById('takiya-name-display').textContent = item.textContent;
            }
        }

        /**
         * ØªØ­ÙˆÙŠÙ„ Ù‚ÙŠÙ…Ø© stat-value Ø¥Ù„Ù‰ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…ÙŠ.
         * @param {HTMLElement} valueElement - Ø¹Ù†ØµØ± stat-value
         * @param {HTMLElement} parentItem - Ø¹Ù†ØµØ± stat-item
         */
        function convertToInputStat(valueElement, parentItem) {
            const field = parentItem.dataset.field;
            const suffix = parentItem.dataset.suffix || '';
            const currentValue = valueElement.textContent.trim().replace(suffix, '').trim();

            parentItem.dataset.initialValue = currentValue;

            const inputElement = document.createElement('input');
            inputElement.type = 'number';
            inputElement.min = 0;
            inputElement.step = 1;
            inputElement.name = field;
            inputElement.className = "form-input";
            inputElement.value = currentValue === '0' || currentValue === '-' ? '' : currentValue;
            inputElement.placeholder = '0';
            inputElement.style.textAlign = 'center';

            valueElement.innerHTML = '';
            valueElement.appendChild(inputElement);
        }

        /**
         * Ø¥Ø¹Ø§Ø¯Ø© Ù‚ÙŠÙ…Ø© stat-value Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶.
         * @param {HTMLElement} valueElement - Ø¹Ù†ØµØ± stat-value
         * @param {HTMLElement} parentItem - Ø¹Ù†ØµØ± stat-item
         */
        function convertToDisplayStat(valueElement, parentItem) {
            const inputElement = valueElement.querySelector('.form-input');
            const suffix = parentItem.dataset.suffix || '';
            const initialValue = parentItem.dataset.initialValue;
            
            if (!inputElement) return;

            const newValue = inputElement.value || initialValue || '0';
            valueElement.textContent = newValue + suffix;
        }

        /**
         * Ø¬Ù…Ø¹ ÙˆØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©.
         */
        function saveTakiyaData() {
            const data = {};
            let hasChanges = false;
            
            // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            basicInfoItems.forEach(item => {
                const inputElement = item.querySelector('.form-input');
                const field = item.dataset.field;
                if (inputElement) {
                    let value;
                    if (inputElement.tagName === 'SELECT') {
                        value = inputElement.value;
                    } else {
                        value = inputElement.value.trim();
                    }
                    data[field] = value;
                    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ± (Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©)
                    const initialValue = item.dataset.initialValue === '-' ? '' : item.dataset.initialValue;
                    if (value !== (initialValue || '')) {
                        hasChanges = true;
                    }
                }
            });

            // 2. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø­Ù‚ÙˆÙ„ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ø®
            equipmentItems.forEach(item => {
                const valueElement = item.querySelector('.stat-value');
                const inputElement = valueElement ? valueElement.querySelector('.form-input') : null;
                const field = item.dataset.field;
                if (inputElement) {
                    const value = inputElement.value.trim();
                    data[field] = value ? parseInt(value) : null; 
                    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ± (Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©)
                    const initialValue = item.dataset.initialValue === '0' || item.dataset.initialValue === '-' ? '' : item.dataset.initialValue;
                    if (value !== (initialValue || '')) {
                        hasChanges = true;
                    }
                }
            });

            if (!hasChanges) {
                 alert("Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„Ù„Ø­ÙØ¸.");
                 toggleEditMode(); // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
                 return;
            }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
            fetch(updateUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…");
                    location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
                } else {
                    alert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: " + (result.error || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
                    console.error("Save error:", result.error);
                }
            })
            .catch(error => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. âŒ");
                console.error('Fetch error:', error);
            });
        }

        // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ø§Ù„Ø¯Ø§Ù„Ø©
        editToggleBtn.addEventListener('click', toggleEditMode);


      // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª (Ø§Ø¨Ù‚Ø§Ø¤Ù‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ)

      const fields = [
        "taslima_date",
        "salt",
        "macaroni",
        "rice",
        "oil",
        "peas",
        "lentils",
        "beans",
        "sauce",
        "luncheon",
        "maggi_spice",
        "vegetable_soup",
        "seven_spices",
        "ghee",
        "bulgur",
        "additions",
      ];

      function showNewRow() {
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙŠØ© ØºÙŠØ± Ù…ÙØ¹Ù„
        if (isEditing) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© ØªØ³Ù„ÙŠÙ….");
            return;
        }

        if (document.getElementById("new-delivery-row")) return;
        const tbody = document.getElementById("delivery-body");
        const newRow = document.createElement("tr");
        newRow.id = "new-delivery-row";
        newRow.style.animation = "fadeIn 0.5s ease-out";

        fields.forEach((field) => {
          const td = document.createElement("td");
          const input = document.createElement("input");

          if (field === "taslima_date") {
            input.type = "date";
          } else if (field === "additions") {
            input.type = "text";
            input.placeholder = "Ø£ÙŠ Ø¥Ø¶Ø§ÙØ§Øª Ø£Ø®Ø±Ù‰...";
          } else {
            input.type = "number";
            input.min = 0;
            input.step = 1;
            input.placeholder = "0";
          }
          input.name = field;
          input.className = "form-input";
          td.appendChild(input);
          newRow.appendChild(td);
        });

        tbody.appendChild(newRow);

        const buttonContainer = document.createElement("div");
        buttonContainer.style.textAlign = "center";
        buttonContainer.style.marginTop = "20px";

        const saveBtn = document.createElement("button");
        saveBtn.innerHTML = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ³Ù„ÙŠÙ…";
        saveBtn.className = "action-btn save";
        saveBtn.onclick = saveNewDelivery;

        const cancelBtn = document.createElement("button");
        cancelBtn.innerHTML = "âœ–ï¸ Ø¥Ù„ØºØ§Ø¡";
        cancelBtn.className = "action-btn cancel";
        cancelBtn.onclick = cancelNewDelivery;

        buttonContainer.appendChild(saveBtn);
        buttonContainer.appendChild(cancelBtn);
        buttonContainer.id = "action-buttons";
        document.querySelector(".table-container").appendChild(buttonContainer);

        document.getElementById("add-row").style.display = "none";
      }

 function saveNewDelivery() {
    const row = document.getElementById("new-delivery-row");
    const inputs = row.querySelectorAll("input");
    const data = {};

    inputs.forEach((input) => {
        if (input.name === 'additions') {
            data[input.name] = input.value || null;
        } else if (input.name === 'taslima_date') {
            data[input.name] = input.value || null;
        } else {
            data[input.name] = input.value ? parseInt(input.value) : null;
        }
    }); 

    if (!data.taslima_date) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…");
        return;
    }

    fetch("{% url 'add_tasleema_for_takiya' takiya.id %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
    })
    .then((response) => response.json())
    .then((result) => {
        if (result.success) {
            location.reload();
        } else {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: " + (result.error || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
    })
    .catch((err) => {
        console.error(err);
        alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
    });
} 

      function cancelNewDelivery() {
        const row = document.getElementById("new-delivery-row");
        const buttons = document.getElementById("action-buttons");
        if (row) row.remove();
        if (buttons) buttons.remove();
        document.getElementById("add-row").style.display = "";
      }
    </script>
  </body>
</html>